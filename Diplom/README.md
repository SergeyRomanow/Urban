## Приложение 2: Руководство пользователя сайта "База данных фильмов и сериалов" на базе фреймворка FastAPI

## СОДЕРЖАНИЕ

1. Введение [>>](#1)
2. Запуск сайта [>>](#2)
     - Настойка окружения [>>](#2.1)
     - Запуск сайта [>>](#2.2)
3. Работа с сайтом [>>](#3)
     - Главная страница [>>](#3.1)
     - Карточка фильма [>>](#3.2)
     - Работа с комментариями [>>](#3.3)
     - Поиск по базе данных [>>](#3.4)
     - Ошибочный ввод [>>](#3.5)
4. Обслуживание сайта [>>](#4)
     - Добавление нового фильма [>>](#4.1)
         * Предварительная подготовка [>>](#4.1.1)
         * Вариант 1: Загрузка через SQL-запросы [>>](#4.1.2)
         * Вариант 2: Загрузка через SQL-файлы [>>](#4.1.3)
         * Вариант 3: Добавление через Swagger [>>](#4.1.4)
         * Проверка результата добавления фильма [>>](#4.1.5)

<a id="1"></a>
## 1. Введение

Данное руководство предназначено для пользователей сайта `База данных фильмов и сериалов`, разработанного на фреймворке `FastAPI` в рамках дипломной работы и показывает порядок работы с web-приложением.

<a id="2"></a>
## 2. Запуск сайта

<a id="2.1"></a>
### 2.1. Настройка окружения

Перед первым запуском необходимо настроить виртуальное окружение Python. Для этого выполните следующую команду:

```bash
pip install -r requirements.txt
```

Дальнейший запуск сайта необходимо выполнять только работая в данном виртуальном окружении.

<a id="2.2"></a>
### 2.2. Запуск сайта

Для запуска сайта необходимо перейти в корневой каталог сайта `FastAPI` и выполнить следующую команду:

```bash
cd FatAPI
python -m uvicorn main:app 
```

<a id="3"></a>
## 3. Работа с сайтом

<a id="3.1"></a>
### 3.1. Главная страница

После запуска сайта переход на главную страницу осуществляется по адресу http://127.0.1:8000

![Главная страница](docs/pic3.1_1.png)

Она представляет собой каталог карточек фильмов, отсортированных по убыванию года производства и рейтингу IMDB. Таким образом все новые добавленные фильмы с высоким рейтингом всегда будут в начале каталога.

Перемещаться по каталогу можно используя ссылки `далее >>` и `<< назад`.

Верхнее меню каталога является закрепленным и позволяет вернуться из любого места сайта на главную страницу (кнопка `Каталог`) или осуществить расширенный поиск по БД фильмов (кнопка `Поиск`).

Для получения более подробной информации о фильме необходимо щелкнуть мышкой по его карточке.

<a id="3.2"></a>
### 3.2. Карточка фильма

Типичная карточка фильма представлена ниже.

![Карточка фильма "Каскадеры"](docs/pic3.2_1.png)

На ней пользователь может получить информацию о фильме, включая его оригинальное название, название на русском, год выпуска, жанр, кем был выпущен (указывается страна и кинокомпания), режиссер, список актеров и краткое содержание фильма.

Также слева под постером фильма указаны рейтинги IMDB и Кинопоиска. В зависимости от величины они имеют разный цвет (зеленый - высокий, желтый - средний и красный - низкий рейтинги).

Если для данного фильма в базу были загружены скриншоты, то они будут представлены ниже. Чтобы ознакомиться с полноразмерным скриншотом нужно щелкнуть по нему мышкой.

![Скриншот в режиме полноразмерного просмотра](docs/pic3.2_2.png)

Для выхода из этого режима необходимо нажать `X` верхнем правом углу, либо клавишу `Esc`.

Также на любой странице карточки фильма есть нижнее меню с кнопками `Назад`, `Комментарии` и `Добавить`.

![Нижнее меню экрана с информацией о фильме](docs/pic3.2_3.png)

Кнопка `Назад` предназаначена для перехода на предыдущую страницу браузера с которой был осуществлен переход на текущую страницу.

Кнопка `Комментарии` предназначена для показа/скрытия комментариев, а `Добавить` - для добавления нового комментария.

Подробная работа с комментариями будет описана ниже.

<a id="3.3"></a>
### 3.3. Работа с комментариями

Для показа/скрытия блока комментариев необходимо на странице с информацией о фильме нажать на кнопку `Комментарии`. Случай когда комментариев к фильму нет, представлен на скриншоте ниже.

![Страница с блоком комментарией с отсутствием комментариев](docs/pic3.3_1.png)

Для добавления нового комментария необходимо нажать кнопку `Добавить` и заполнить текст комментария к фильму в специальной форме.

![Добавление комментария](docs/pic3.3_2.png)

После нажатия `Отправить` комментарий появится в соответствующем блоке страницы фильма.

![Страница с добавленным комментарием](docs/pic3.3_3.png)

<a id="3.4"></a>
### 3.4. Поиск по базе данных

Для осуществления поиска по любой информации о фильме необходимо в верхнем меню сайта выбрать кнопку `Поиск` и заполнить необходимые поля формы.  

Поиск может осуществляться по нескольким полям одновремено с использованием ключевых слов `и/или` млм `and/or` в любом регистре. Пример заполненной формы с критериями поиска представлен ниже.

![Форма с введенными параметрами поиска](docs/pic3.4_1.png)

В данном случае требуется найти в базе данных комедии или боевики с рейтингом IBDB от 5.0 российского или американского производства в которых снимались вместе Милош Бикович и Аглая Тарасова или фильмы с Дженнифер Лопес. Далее представлен результат поиска.

![Результаты поиска](docs/pic3.4_2.png)

В случае если результаты поиска не вмещаются на одну страницу, просматривать их можно используя элементы навигации `далее >>` и `<< назад`.

Например ниже представлены результаты поиска по жанру `приключения`.

![Результаты поиска по жанру "приключения"](docs/pic3.4_3.png)

<a id="3.5"></a>
## 3.5. Ошибочный ввод

В случае, если пользователь пытается зайти на несуществующую страницу или результат поиска в базе данных отрицательный, отображается следующая страница.

![Страница с ошибкой 404"](docs/pic3.5_1.png)


<a id="4"></a>
## 4. Обслуживание сайта

<a id="4.1"></a>
### 4.1. Добавление нового фильма

Добавление информации о новом фильме осуществляется в следующих режимах:

- через SQL-запросы к БД, используя утилиту `sqlite3`;
- через загрузку данных из файлов, также используя `sqlite3`.

Вместо `sqlite3` можно использовать любое приложение работающее с БД SQlite.

Рассмотрим пример добавление нового российского фильма `"Сто лет тому вперед" (2024)` в базу данных

<a id="4.1.1"></a>
### 4.1.1. Предварительная подготовка

Соберем данные о фильме, включая постер (200 x 300) px, полноразмерные скриншоты и миниатюры скриншотов (320 x 180) px. Данные размеры являются рекомендованными.

По добавляемому фильму все необходимые данные содержатся в `data.sql\add_movie.example\`.

В соответствии с архитектурой приложения и для быстродействия постеры и миниатюры скриншотов хранятся локально. Перенесем их в общий каталог БД выполнив команду из каталога `Django`. Далее будут подробно рассмотрены скрипты под `ОС Windows`.:

```cmd
copy data.sql\add_movie.example\poster_26.jpg static\image\
copy data.sql\add_movie.example\shots.small\shot_26*.* static\image\shots.small\
```

Полноразмерные скриншоты находятся на удаленном ресурсе и должны быть предварительно загружены на внешний файл-хостинг. Ссылки представлены ниже:

```
shot_26_01.png => https://imageup.ru/img100/4910360/shot_26_01.png
shot_26_02.png => https://imageup.ru/img273/4910363/shot_26_02.png
shot_26_03.png => https://imageup.ru/img67/4910364/shot_26_03.png
shot_26_04.png => https://imageup.ru/img13/4910366/shot_26_04.png
```

<a id="4.1.2"></a>
### 4.1.2. Вариант 1: Загрузка через SQL-запросы

Используя утилиту `sqlite3` выполним следующие команды для загрузки данных:

```cmd
sqlite3 movies.db

INSERT INTO movies VALUES (
26,
'Сто лет тому вперёд',
'Сто лет тому вперёд',
2024,
'poster_26.jpg',
'фантастика, приключения, детский, семейный',
'Россия, Кинокомпания Водород, Art Pictures Studio',
'Александр Андрющенко',
'Даша Верещагина, Марк Эйдельштейн, Константин Хабенский, Виктория Исакова, Фёдор Бондарчук, Александр Петров (II), Юрий Борисов (II), Софа Цибирева, Матвей Астраханцев, Кирилл Митрофанов',
'Они живут в разных мирах. Коля Герасимов - в сегодняшней Москве, Алиса Селезнева - на сто лет позже. Коля - обычный парень, ему нет дела до будущего. Алису не отпускает прошлое: она должна найти маму, которую потеряла, когда была совсем ребенком.',
5.9,
7.4);

INSERT INTO shots (file, movie_id, url) 
VALUES('shot_26_01.jpg',26,'https://imageup.ru/img100/4910360/shot_26_01.png');

INSERT INTO shots (file, movie_id, url) 
VALUES('shot_26_02.jpg',26,'https://imageup.ru/img273/4910363/shot_26_02.png');

INSERT INTO shots (file, movie_id, url) 
VALUES('shot_26_03.jpg',26,'https://imageup.ru/img67/4910364/shot_26_03.png');

INSERT INTO shots (file, movie_id, url) 
VALUES('shot_26_04.jpg',26,'https://imageup.ru/img13/4910366/shot_26_04.png');
```
P.S. Необходимо учитывать, что в данном случае загружена информация по фильму с уникальным кодом `26`. Для каждого загруженного фильма используйте уникальные коды или счетчик.

<a id="4.1.3"></a>
### 4.1.3. Вариант 2: Загрузка через SQL-файлы

Запишем данные фильма и скриншотов в `SQL-файлы` для последующей загрузки в `sqlite3`. 
Уже загруженные данные для этого фильма находятся в каталоге `data.sql\add_movie.example` 

- add_movie.sql
- add_shots.sql

Выполним следующие команды: 

```cmd
sqlite3 movies.db
.read data.sql\add_movie.example\add_movie.sql
.read data.sql\add_movie.example\add_shots.sql
```

<a id="4.1.4"></a>
### 4.1.4. Вариант 3: Добавление через Swagger

Для доступа к главной странице документации `Swagger` перейдем на <http://127.0.0.1:8000/docs>.

![Документация Swagger(версия для FastAPI)](docs/pic4.1_1.png)

Добавим информацию о нашем фильме. Для этого выберем `movie` -> `POST` -> `Try it out` и заполним необходимые поля как указано ниже.

![Добавление информации о новом фильме](docs/pic4.1_2.png)

После этого необходимо нажать `Execute` и проверить статус добавления фильма.

![Проверка статуса добавления фильме](docs/pic4.1_3.png)

Статус-код `201` показывает, что фильм был добавлен **успешно**.

Теперь при желании можно добавить с фильму скриншоты. Пример добавления первого из 4-х заранее приготовленных скриншотов (см. [п.4.1.1](#4.1.1)) представлен ниже.

Для этого в `Swagger` выберем `shot` -> `POST` -> `Try it out` и заполним необходимые поля.

![Добавление скриншота для фильма](docs/pic4.1_4.png)

После нажатия `Execute` проверим статус добавления скриншота.

Статус-код `201` показывает, что скриншот был добавлен **успешно**.

Остальные скриншоты добавляются по тому же принципу.

![Проверка статуса добавления скриншота](docs/pic4.1_5.png)

<a id="4.1.5"></a>
### 4.1.5. Проверка результата добавления фильма

Посмотрим страницу добавленного фильма на сайте. 

Для этого найдем его через `Поиск` или `Каталог`.

![Добавленный фильм "Сто лет тому вперед" на сайт](docs/pic4.1_6.png)

Done!